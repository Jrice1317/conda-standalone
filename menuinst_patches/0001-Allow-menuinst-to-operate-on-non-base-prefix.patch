From d810b6bab474cb9b00a6a8a95c8fbd0e3e33bbf6 Mon Sep 17 00:00:00 2001
From: Eric Prestat <eric.prestat@gmail.com>
Date: Sat, 31 Jul 2021 17:45:30 +0100
Subject: [PATCH] Allow menuinst to operate on non base prefix

---
 menuinst/win32.py | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/menuinst/win32.py b/menuinst/win32.py
index 67f222a..fa774a5 100644
--- a/menuinst/win32.py
+++ b/menuinst/win32.py
@@ -170,8 +170,8 @@ def substitute_env_variables(text, dir):
 
     for a, b in (
         (u'${PREFIX}', env_prefix),
-        (u'${ROOT_PREFIX}', unicode_root_prefix),
-        (u'${DISTRIBUTION_NAME}', os.path.split(unicode_root_prefix)[-1].capitalize()),
+        (u'${ROOT_PREFIX}', env_prefix),
+        (u'${DISTRIBUTION_NAME}', os.path.split(env_prefix)[-1].capitalize()),
         (u'${PYTHON_SCRIPTS}',
           os.path.normpath(join(env_prefix, u'Scripts')).replace(u"\\", u"/")),
         (u'${MENU_DIR}', join(env_prefix, u'Menu')),
@@ -285,6 +285,7 @@ class ShortCut(object):
         args = []
         fix_win_slashes = [0]
         prefix = self.menu.prefix.replace('/', '\\')
+        unicode_root_prefix = to_unicode(prefix)
         root_py  = join(unicode_root_prefix, u"python.exe")
         root_pyw = join(unicode_root_prefix, u"pythonw.exe")
         env_py  = join(prefix, u"python.exe")
-- 
2.30.2

